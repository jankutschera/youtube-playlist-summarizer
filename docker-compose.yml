version: '3.8'

services:
  youtube-summarizer:
    build: .
    container_name: youtube-summarizer
    restart: always
    volumes:
      - ./data:/data
      - ./templates:/app/templates
      - ./static:/app/static
      - ./web_app.py:/app/web_app.py
      - ./youtube_summarizer.py:/app/youtube_summarizer.py
      - ./backfill_videos.py:/app/backfill_videos.py
      - ./start.sh:/app/start.sh
    ports:
      - "8080:5000"
    environment:
      # Claude API
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}

      # Email Einstellungen
      - EMAIL_FROM=${EMAIL_FROM}
      - EMAIL_TO=${EMAIL_TO}
      - EMAIL_PASSWORD=${EMAIL_PASSWORD}

      # SMTP Server (Gmail)
      - SMTP_SERVER=smtp.gmail.com
      - SMTP_PORT=587

      # Prüfintervall in Minuten
      - CHECK_INTERVAL_MINUTES=${CHECK_INTERVAL_MINUTES:-30}

      # YouTube Playlist ID
      - PLAYLIST_ID=${PLAYLIST_ID}

      # RapidAPI Keys für YouTube Transkripte (mehrere Keys mit Komma getrennt)
      - RAPIDAPI_KEYS=${RAPIDAPI_KEYS}

      # Flask
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-change-this-secret-key-in-production}
      - REDIRECT_URI=http://localhost:8080/oauth2callback
      - OAUTHLIB_INSECURE_TRANSPORT=1

    command: bash start.sh

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 10s
